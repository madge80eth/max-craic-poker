<!DOCTYPE html>
<html>
<head>
  <title>MCP Admin</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
    button { padding: 15px 30px; font-size: 16px; margin: 10px; cursor: pointer; }
    .reset { background: #dc2626; color: white; border: none; border-radius: 8px; }
    .draw { background: #10b981; color: white; border: none; border-radius: 8px; }
    .test { background: #f59e0b; color: white; border: none; border-radius: 8px; }
    .status { background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0; }
    pre { background: #1f2937; color: #10b981; padding: 10px; border-radius: 4px; overflow-x: auto; }
    .section { margin: 30px 0; padding: 20px; border: 2px solid #e5e7eb; border-radius: 12px; }
    h2 { color: #1f2937; margin-top: 0; }
    .description { color: #6b7280; margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>Max Craic Poker Admin</h1>

  <div class="section">
    <h2>üß™ Testing</h2>
    <p class="description">Add test wallets to quickly test the draw functionality without manual entries</p>
    <button class="test" onclick="testDraw()">Add Test Entries</button>
    <p style="color: #6b7280; font-size: 14px; margin-top: 10px;">Adds 4 test wallets to the current draw</p>
  </div>

  <div class="section">
    <h2>üé≤ Draw Management</h2>
    <p class="description">Trigger the draw to select winners or reset to start fresh</p>
    <button class="draw" onclick="triggerDraw()">Trigger Draw</button>
    <button class="reset" onclick="resetDraw()">Reset Draw</button>
  </div>

  <div class="section">
    <h2>üèÜ Monthly Leaderboard</h2>
    <p class="description">Snapshot the leaderboard at end of month for NFT rewards</p>
    <button class="draw" onclick="snapshotLeaderboard()">Snapshot Current Month</button>
    <p style="color: #6b7280; font-size: 14px; margin-top: 10px;">
      Creates snapshot of top 3 supporters for coaching NFT eligibility
    </p>
  </div>

  <div class="section">
    <h2>üìä System Status</h2>
    <div class="status" id="status"></div>
  </div>

  <script>
    async function testDraw() {
      if (!confirm('Add 4 test wallets to the draw?\n\nThis will add test entries you can use to test the draw functionality.')) return;

      const response = await fetch('/api/test-draw', { method: 'POST' });
      const data = await response.json();
      document.getElementById('status').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';

      if (data.success) {
        setTimeout(checkStatus, 1000); // Refresh status after adding
      }
    }

    async function triggerDraw() {
      if (!confirm('Trigger the draw now?\n\nThis will select 3 winners from current entries.')) return;

      const response = await fetch('/api/draw', { method: 'POST' });
      const data = await response.json();
      document.getElementById('status').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';

      if (data.success) {
        setTimeout(checkStatus, 1000); // Refresh status after draw
      }
    }

    async function resetDraw() {
      if (!confirm('Reset the draw?\n\nThis clears:\n- All current entries\n- Winner data\n\nPreserves:\n- Entry history (leaderboard)\n\nThe app will revert to showing the next stream countdown.')) return;

      const response = await fetch('/api/reset', { method: 'POST' });
      const data = await response.json();
      document.getElementById('status').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';

      if (data.success) {
        setTimeout(checkStatus, 1000); // Refresh status after reset
      }
    }

    async function snapshotLeaderboard() {
      if (!confirm('Snapshot current leaderboard?\n\nThis will:\n- Save top 3 supporters for this month\n- Allow them to claim coaching NFTs\n- Prepare for next month\'s competition\n\nNote: You can only snapshot once per month.')) return;

      const response = await fetch('/api/leaderboard/snapshot', { method: 'POST' });
      const data = await response.json();
      document.getElementById('status').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';

      if (data.success) {
        setTimeout(checkStatus, 1000);
      }
    }

    async function checkStatus() {
      const response = await fetch('/api/reset');
      const data = await response.json();
      document.getElementById('status').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    }

    // Auto-refresh status every 10 seconds
    checkStatus();
    setInterval(checkStatus, 10000);
  </script>
</body>
</html>
